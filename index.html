<!--
宙の辻 - Sora no Tsuji
Copyright (c) 2026- Sora no Tsuji Project

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
-->
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="宙の辻 - Sora no Tsuji: ダイヤモンド富士やパール富士、特定の山の『推し山』ダイヤモンドが見られる時間と場所の「辻（交差点）」をマップ上に可視化するWebアプリ。">
    <meta property="og:title" content="宙の辻 - Sora no Tsuji">
    <meta property="og:description" content="ダイヤモンド富士やパール富士、特定の山の『推し山』ダイヤモンドが見られる時間と場所の「辻（交差点）」をマップ上に可視化するWebアプリ。">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://soranotsuji.design10100.net/">
    <meta property="og:image" content="https://soranotsuji.design10100.net/ogpV1.7.png">
    <meta property="og:site_name" content="宙の辻">
    <meta property="og:locale" content="ja_JP">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="宙の辻 - Sora no Tsuji">
    <meta name="twitter:description" content="ダイヤモンド富士や特定の山の『推し山』ダイヤモンドが見える時間と場所の「辻（交差点）」をマップ上に可視化するWebアプリ。">
    <meta name="twitter:image" content="https://soranotsuji.design10100.net/ogpV1.7.png">
    <meta name="google-site-verification" content="2lAHbwDdCuACvK0K2-OLOqOKltOPSYYnbPO1vcdbRjo" />
    <title>宙の辻 - Sora no Tsuji</title>
    
    <link rel="icon" href="logoICO.png" type="image/png">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>

    <link rel="stylesheet" href="style.css">

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <script src="https://cdn.jsdelivr.net/npm/astronomy-engine@2.1.19/astronomy.browser.min.js"></script>
</head>
<body>

    <div id="map"></div>

    <div id="elevation-panel" class="hidden">
        <canvas id="elevation-canvas"></canvas>
        <div id="elevation-info">Start -> End (100m間隔)</div>
        
        <div id="progress-overlay" class="hidden">
            <div class="progress-label">データ取得中... <span id="progress-text">0%</span></div>
            <div class="progress-track">
                <div id="progress-bar"></div>
            </div>
        </div>
    </div>

    <div id="control-panel" class="control-panel minimized">
        <div class="panel-header" onclick="togglePanel()">
            <span id="header-title">
                <img src="logo.png" alt="ロゴ" class="header-logo">
                宙の辻<span class="header-subtitle"> - Sora no Tsuji</span>
            </span>
            <div class="header-controls">
                <span id="btn-help" title="ヘルプ">?</span>
                <span id="toggle-icon">▼</span>
            </div>
        </div>
    
        <div id="panel-content" class="panel-content">
            
            <div class="section">
                <div class="section-header" onclick="toggleSection('sec-location')">
                    <span>位置情報</span> <span id="icon-sec-location">▲</span>
                </div>
                <div id="sec-location" class="section-content">
                    
                    <div class="control-row">
                        <div class="btn-group-left">
                            <button id="btn-gps" class="nav-btn small" title="現在地を取得">GPS</button>
                            <input type="radio" name="loc-mode" id="radio-start" value="start" checked>
                        </div>
                        <label class="input-label">観測点:</label>
                        <input type="text" id="input-start-latlng" placeholder="地名 住所 緯度,経度">
                    </div>

                    <div class="control-row">
                        <div class="btn-group-left">
                            <button id="btn-reg-start" class="nav-btn small" title="現在の観測点を初期値として登録">Hom</button>
                        </div>
                        <label class="input-label">観測点高:</label>
                        <input type="number" id="input-start-elev" placeholder="標高 m" step="1">
                    </div>

                    <div class="control-row">
                        <div class="btn-group-left">
                            <button id="btn-reg-end" class="nav-btn small" title="現在の目的点を初期値として登録">推山</button>
                            <input type="radio" name="loc-mode" id="radio-end" value="end">
                        </div>
                        <label class="input-label">目的点:</label>
                        <input type="text" id="input-end-latlng" placeholder="地名 住所 緯度,経度">
                    </div>

                    <div class="control-row">
                        <div class="btn-group-left">
                            <div style="width: 46px;"></div> 
                        </div>
                        <label class="input-label">目的点高:</label>
                        <input type="number" id="input-end-elev" placeholder="標高 m" step="1">
                    </div>

                    <div class="control-row main-buttons-row">
                        <button id="btn-dp" class="nav-btn main-btn" title="辻ライン表示">辻ライン</button>
                        <button id="btn-elevation" class="nav-btn main-btn">標高グラフ</button>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-header" onclick="toggleSection('sec-datetime')">
                    <span>日時情報</span> <span id="icon-sec-datetime">▲</span>
                </div>
                <div id="sec-datetime" class="section-content">
                    <div class="control-row">
                        <button id="btn-now" class="nav-btn small">Now</button>
                        <button id="btn-month-prev" class="nav-btn">◀◀</button>
                        <button id="btn-date-prev" class="nav-btn">◀</button>
                        <input type="date" id="date-input">
                        <button id="btn-date-next" class="nav-btn">▶</button>
                        <button id="btn-month-next" class="nav-btn">▶▶</button>
                    </div>

                    <div class="control-row">
                        <button id="btn-move" class="nav-btn small">Mov</button>
                        <button id="btn-hour-prev" class="nav-btn">◀◀</button>
                        <button id="btn-time-prev" class="nav-btn">◀</button>
                        <input type="time" id="time-input" value="12:00">
                        <button id="btn-time-next" class="nav-btn">▶</button>
                        <button id="btn-hour-next" class="nav-btn">▶▶</button>
                    </div>

                    <input type="range" id="time-slider" min="0" max="1439" step="1" value="720">
                    
                    <div class="shortcuts">
                        <div class="shortcut-item">
                            <input type="radio" name="time-jump" id="jump-sunrise" value="sunrise">
                            <label for="jump-sunrise">🌞日の出 <span id="time-sunrise">--:--</span></label>
                        </div>
                        <div class="shortcut-item">
                            <input type="radio" name="time-jump" id="jump-sunset" value="sunset">
                            <label for="jump-sunset">🌞日の入 <span id="time-sunset">--:--</span></label>
                        </div>
                        <div class="shortcut-item">
                            <input type="radio" name="time-jump" id="jump-moonrise" value="moonrise">
                            <label for="jump-moonrise">🌛月の出 <span id="time-moonrise">--:--</span></label>
                        </div>
                        <div class="shortcut-item">
                            <input type="radio" name="time-jump" id="jump-moonset" value="moonset">
                            <label for="jump-moonset">🌛月の入 <span id="time-moonset">--:--</span></label>
                        </div>
                    </div>

                    <div class="control-row moon-row">
                        <button id="btn-moon-prev" class="nav-btn">◀</button>
                        <div class="moon-display">
                            <label>月齢</label>
                            <input type="number" id="moon-age-input" step="0.1" min="0" max="30.0">
                            <span id="moon-icon" class="moon-icon">🌑</span>
                        </div>
                        <button id="btn-moon-next" class="nav-btn">▶</button>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-header" onclick="toggleSection('sec-mystar')">
                    <span>My天体</span> <span id="icon-sec-mystar">▲</span>
                </div>
                <div id="sec-mystar" class="section-content">
                    <div class="control-row">
                        <button id="btn-mystar-reg" class="nav-btn small">登録</button>
                        <input type="text" id="input-mystar-radec" placeholder="赤経,赤緯">
                    </div>
                    <div class="celestial-list" style="margin-top: 5px; border-bottom: none;">
                        <li style="border-bottom: none; padding-bottom: 0;">
                            <input type="checkbox" id="chk-mystar" class="body-checkbox">
                            <div id="style-MyStar" class="style-indicator solid" style="color: #DDA0DD;" onclick="openPalette('MyStar')"></div>
                            <div class="body-info">
                                <span class="body-name">My天体</span>
                                <span id="data-MyStar" class="body-detail-text">--:--</span>
                            </div>
                        </li>
                    </div>
                </div>
            </div>
    
            <div class="section">
                <div class="section-header" onclick="toggleSection('sec-bodies')">
                    <span>表示天体</span> <span id="icon-sec-bodies">▲</span>
                </div>
                <div id="sec-bodies" class="section-content">
                    <ul id="celestial-list" class="celestial-list"></ul>
                </div>
            </div>

            <div class="visitor-counter">
                <div class="counter-row">
                    <span>本日: <span id="cnt-today">-</span></span>
                    <span>昨日: <span id="cnt-yesterday">-</span></span>
                </div>
                <div class="counter-row">
                    <span class="clickable-stat" onclick="showGraph('current')">今年: <span id="cnt-year">-</span></span>
                    <span class="clickable-stat" onclick="showGraph('last')">昨年: <span id="cnt-last">-</span></span>
                </div>
            </div>

            <div class="panel-footer">
                &copy; 2026- Sora no Tsuji Project - V1.10.0
            </div>
        </div>
    </div>
    
    <div id="style-palette" class="style-palette hidden">
        <div class="palette-header">スタイル設定 <span class="close-palette" onclick="closePalette()">×</span></div>
        <div class="palette-colors" id="palette-colors"></div>
        <div class="palette-lines" id="palette-lines">
            <div class="line-option" onclick="applyLineStyle('solid')">実線 <span class="line-preview solid"></span></div>
            <div class="line-option" onclick="applyLineStyle('dashed')">破線 <span class="line-preview dashed"></span></div>
        </div>
    </div>

    <div id="help-modal" class="hidden">
        <div class="help-content">
            <div class="help-header">
                <h2>宙の辻 - ヘルプ</h2>
                <span class="close-help" onclick="toggleHelp()">×</span>
            </div>
            <div class="help-body">
                <h3>概要</h3>
                <p><strong>「時」と「場所」が交差する瞬間を、地図上で探す。</strong></p>
                <p>「宙の辻 - Sora no Tsuji」は、天体シミュレーションと地図情報を組み合わせたWebアプリケーションです。特定の日時・場所における太陽、月、惑星、恒星の位置を計算し、ダイヤモンド富士やパール富士、ダイヤモンド槍ヶ岳に、特定の山の『推し山』ダイヤモンドが見られる時間と場所の「辻（交差点）」をマップ上に可視化します。</p>
                
                <h3>位置情報の設定</h3>
                <ul>
                    <li><strong>GPS:</strong> 現在地を観測点に設定します。</li>
                    <li><strong>観測点/目的点:</strong> 地図をクリック、または、「東京タワー」「富士山」などの地名・およその住所、または、緯度,経度を入力してEnterキーを押すと検索・設定できます。ラジオボタンは、観測点/目的点のクリック時の入力切り替えです。初期値は、東京タワー(観測点)と富士山(目的点)です。</li>
                    <li><strong>観測点高/目的点高:</strong> 観測点/目的点が入力されると自動で標高を取得します。手動で数値を修正してシミュレーションすることも可能です。</li>
                    <li><strong>Hom:</strong> 観測点/観測点高の登録・呼出ボタンです。未登録時は現在の値を登録（黄色）し、登録済みの場合は保存された値を呼び出します。入力欄を空にして押すと登録を解除（リセット）します。</li>
                    <li><strong>推山:</strong> 目的点/目的点高の登録・呼出ボタンです。未登録時は現在の値を登録（黄色）し、登録済みの場合は保存された値を呼び出します。入力欄を空にして押すと登録を解除（リセット）します。</li>
                </ul>

                <h3>日時情報の設定</h3>
                <ul>
                    <li><strong>Now:</strong> 現在日時にリセットします。</li>
                    <li><strong>Mov:</strong> 1日1秒で時間を自動で進めます（アニメーション）。</li>
                    <li><strong>月齢:</strong> 月齢の数値を変更して、満月(15)や新月(0,30)の日にジャンプできます。◀︎ ▶︎ボタンで、およそ同じ次の月齢の日時にジャンプできます。</li>
                </ul>

                <h3>「辻ライン」機能 (ダイヤモンド・パールなど)</h3>
                <p>「辻ライン」ボタンをオン（黄色）にすると、観測点と目的点（山頂など）を結ぶライン上で、天体が山頂と重なる位置(視高度)を計算し、その時間と場所の軌跡を地図上に曲線で表示します。</p>
                <ul>
                    <li><strong>破線（---）:</strong> 設定した日時のライン（10分刻みの「●」マーカーと時刻を表示）</li>
                    <li><strong>点線（···）:</strong> 前日および翌日のライン（ラインのみ表示）</li>
                </ul>
                <p>太陽（赤🟥）、月（黄🟨）、および表示中の惑星やMy天体について計算されます。</p>

                <h3>標高グラフ</h3>
                <p>観測点と目的点の間の断面標高をグラフに表示します。サーバー低負荷にするため100m3秒おきに算出します。ブラウザを表示したままで気長にお待ちいただくか、PCでの利用を推奨します。</p>

                <h3>My天体</h3>
                <p>お好みの恒星などの座標（赤経, 赤緯）を登録して表示できます。初期値はオリオン座のアルニラムです。入力欄を空にして押すと登録を解除（リセット）します。</p>

                <h3>表示天体</h3>
                <p>太陽、月、水星、金星、火星、木星、土星、天王星、海王星、冥王星、北極星、すばる、のそれぞれを出没時刻、入没時刻、方位、高度がわかります。高度が負数(およそ地平線下)になると線が半透明になります。チェックボックスで表示・非表示にできます。また、カラーパレットで、色と線種を変更できます。リロードで元に戻ります。</p>

                <h3>地図上の線のズレについて（豆知識）</h3>
                <p>距離が遠い場合、<strong>地図上の「観測点からの色付きの方位線」と「観測点と目的点を結ぶ黒い線」と「辻ラインのマーカー(破線と点線の曲線)」</strong>がズレて見えることがあります。</p>
                <p>これは、<strong>「地球は丸いのに、地図は平ら」</strong>であるために起こる現象です。</p>
                <ul>
                    <li><strong>方位線:</strong> 地球の丸みを考慮した方位になります。</li>
                    <li><strong>黒い線:</strong> 平面上の単純な2点間の方位になります。</li>
                    <li><strong>辻ライン:</strong> 目的点上に天体が見える位置の時間の軌跡のため、方位を表してはいません。</li>
                </ul>
                <p>距離が遠くなるほど、メルカトル図法の性質上、方位線と黒い線はズレて表示されます。辻ラインは、そもそも、方位線と黒い線とは重なりません。</p>
                <p><strong>辻ライン上の位置と時刻に観測点を設定した時が、天文学的・地理学的に正しい位置と方位を示します。</strong></p>

                <h3>注意事項・免責事項</h3>
                <ul>
                    <li>本サイトでの表示内容は、その情報の正確性を保証するものではありません。実際の観測には十分な余裕を持って行動してください。</li>
                    <li>本サイトは、国土地理院などの無料サービスを利用して成り立っています。サーバーに高負荷をかける行為はご遠慮ください。</li>
                    <li>本サイトを利用したことにより生じたいかなる損害についても責任を負いません。</li>
                </ul>

                <h3>謝辞</h3>
                <p>本サイトを制作するにあたって利用した <a href="https://github.com/cosinekitty/astronomy" target="_blank" rel="noopener noreferrer">Astronomy Engine Project</a>、並びに、AIのGeminiさんに、並々ならぬ感謝の意を表します。</p>

                <h3>お知らせ</h3>
                <ul>
                    <li>本サイトに関するご意見・ご感想は、<a href="https://note.com/takeyosui" target="_blank" rel="noopener noreferrer">たけちゃん</a>まで、お知らせください。</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="graph-modal" class="hidden">
        <div class="help-content graph-content">
            <div class="help-header">
                <h2 id="graph-title">訪問者数推移</h2>
                <span class="close-help" onclick="closeGraph()">×</span>
            </div>
            <div class="help-body">
                <canvas id="visitor-canvas" height="300"></canvas>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>